<!DOCTYPE html>
<html lang="en">
<head>
    <div class="topnav">
        <button onclick="Home()" >Home</button>
        <button onclick="myStores()" >My Stores</button>
        <button onclick="MyCart()" >My Cart</button>

        <button onclick="logOut()" id="logOut">LogOut</button>
    </div>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        h1 {
        border-radius: 20px;
        border: 1px solid #FF4B2B;
        background-color: #FF4B2B;
        color: #FFFFFF;
        font-size: 12px;
        font-weight: bold;
        padding: 12px 45px;
        letter-spacing: 1px;
        text-transform: uppercase;
        transition: transform 80ms ease-in;
        margin: 5px 5px 5px;
        width: 10px;
        }
#store:hover{
background-color: #5F9EA0}

#product{
  border: #333;
  border-radius: 5px;
  border-width: 1px;
  padding-bottom: 10px;

}

#logOut{
position:absolute;
     top:3;
     right:0;
}

.topnav button
{
  float: left;
  color: #green;
  text-align: center;
  padding: 14px 16px;
  text-decoration: none;
  font-size: 17px;
}

/* Add a black background color to the top navigation */
.topnav {
  background-color: #333;
  overflow: hidden;
}


/* Change the color of links on hover */
.topnav button:hover {
  background-color: #ddd;
  color: black;
}

/* Add a color to the active/current link */
.topnav button.active {
  background-color: #4CAF50;
  color: green;
}

    </style>
</head>
<body>
<div>
    <ul id="list">
    </ul>
</div>


</body>
</html>
<script>

var ws = new WebSocket("wss://localhost:4567/Store/currentStore")
ws.onopen = function(event)
    {
      console.log("welcome to curr store page");
        console.log(localStorage.getItem("storeId"));
        ws.send(JSON.stringify({"type":"GET_PRODUCTS","storeId":localStorage.getItem("storeId")}));
    }

ws.onmessage = function(event)
{
    const parsedMessage= JSON.parse(event.data);
    console.log(parsedMessage);
    if(parsedMessage.type=="PRODUCTS"){
    console.log(parsedMessage.items);
    products= parsedMessage.items;
		for (let i = 0; i < products.length; i++) {
        document.getElementById("list").innerHTML  += '<div type="product">';
        document.getElementById("list").innerHTML  += '<h1>' + products[i].productName + '</h1>'
        document.getElementById("list").innerHTML  += '<h3>price: '+products[i].price +'</h2>'
          document.getElementById("list").innerHTML  += '<h3>amount: '+products[i].amount +'</h2>'
        document.getElementById("list").innerHTML  += '<input id="input'+products[i].productId+'"/>'
        document.getElementById("list").innerHTML  += '<button onclick="addProduct('+products[i].productId+')">Add to Cart</button>'
        document.getElementById("list").innerHTML  += '</div>';

        document.getElementById("list").innerHTML  +='';

  }
    }
  else if(parsedMessage.type=="LOGOUT")
  {
    result = parsedMessage.result;
    if(result)
      window.location.href = "Login";
    else
      alert("Error Log Out");
  }else if(parsedMessage.type=="ADD_PRODUCT"){
    result = parsedMessage.result;
    console.log(result);
    if(result){
      alert("Product Added Successfully");
      window.location.href = "Store"
    }else{
      alert("Error with Adding Product");
    }
    
  }
}
const logOut= () =>
{
	 ws.send(JSON.stringify({"type":"LOGOUT","id":localStorage.getItem("id")}));
}
const addProduct=(productId)=>{

  amount = document.getElementById(`input${productId}`).value;
  console.log(productId);
  console.log(amount);
  ws.send(JSON.stringify({"type":"ADD_PRODUCT","productId":productId,"amount":amount,"userId":localStorage.getItem("id"),"storeId":localStorage.getItem("storeId")}));

}

const Home= () =>
{
	 window.location.href = "Main";
}

const MyCart = ()=>{
   window.location.href = "Cart";
}

const myStores= () =>
{
	window.location.href = "myStores";
}


</script>
